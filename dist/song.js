"use strict";function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(a);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}var id=getParameterByName("id"),query=new AV.Query("Song");query.get(id).then(function(e){var a=e.attributes,t=a.url,r=a.lyric,n=e.attributes.images,i=e.attributes.singer,s='<img class="cover" src="'+n+'" alt="封面图片">';$(".circle").append(s),$(".background").css("background-image","url("+n+")");var c="<h2>"+i+"</h2>";$(".lyric > .name").append(c);var l=document.createElement("audio");l.src=t,$("body").append(l),$(".pointer").addClass("pause"),$(".icon-pause3").on("click",function(){l.pause(),$(".circle").removeClass("playing"),$(".pointer").addClass("pause")}),$(".icon-play1").on("click",function(){l.play(),$(".circle").addClass("playing"),$(".pointer").removeClass("pause")}),l.loop=!1,l.addEventListener("ended",function(){$(".circle").removeClass("playing"),$(".pointer").addClass("pause")},!1);var o=[];r.split("\n").forEach(function(e,a){var t=e.split("]");t[0]=t[0].substring(1);var r=/(\d+):([\d.]+)/,n=t[0].match(r),i=+n[1],s=+n[2];o.push({time:60*i+s,lyric:t[1]})});var p=$(".lyric > .song-lyric");o.map(function(e){if(e){var a=$("<p/>");a.attr("data-time",e.time).text(e.lyric),a.appendTo(p.children(".lines"))}}),setInterval(function(){for(var e,a=$(".lines > p"),t=l.currentTime,r=0;r<a.length;r++){var n=a.eq(r).attr("data-time"),i=a.eq(r+1).attr("data-time");if(0!==a.eq(r+1).length&&n<t&&i>t&&(e=a.eq(r)),e){e.addClass("active").prev().removeClass("active");var s=e.offset().top,c=$(".lines").offset().top,o=Math.floor(s-c-$(".song-lyric").height()/4);$(".lines").css("transform","translateY(-"+o+"px)")}}},300)});